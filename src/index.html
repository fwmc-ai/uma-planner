<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Uma Musume Pretty Derby Global Career Planner - Complete character database and training optimizer">
    <meta name="theme-color" content="#ec4899">

    <title>Uma Musume Career Planner</title>

    <!-- PWA manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- Icons -->
    <link rel="icon" type="image/png" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🏇</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🏇</text></svg>">

    <!-- Tailwind CSS - Production Version -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">

    <!-- Custom styles -->
    <link rel="stylesheet" href="css/styles.css">

    <!-- Module Loading System -->
    <script src="./js/module-loader.js"></script>

    <!-- Just using vanilla JavaScript - no React needed -->
    <script>
        // Simple icon replacement system
        const Icons = {
            Search: '🔍',
            Filter: '🔧',
            ArrowLeft: '←',
            Target: '🎯',
            TrendingUp: '📈',
            Users: '👥',
            Star: '⭐',
            RotateCcw: '🔄',
            ChevronDown: '▼',
            ChevronUp: '▲',
            Info: 'ℹ️',
            Book: '📖',
            Trophy: '🏆',
            Sparkles: '✨',
            Heart: '❤️'
        };
    </script>

</head>
<body>
    <div id="root">
        <div class="loading-container">
            <div class="loading-content">
                <div class="loading"></div>
                <p class="loading-text">Loading Uma Musume Career Planner...</p>
            </div>
        </div>
    </div>

    <script>
        // State, constants, utils, data helpers, skills, character advice, events, components, and app loaded from external modules
        let appState, updateAppState;
        let STYLES, TRACK_TYPES, RARITIES, APTITUDE_GRADES, CHARACTERS, STAT_THRESHOLDS, STAT_EFFICIENCY, SKILL_RECOMMENDATIONS;
        let createElement, getRarityStars, getStyleColor, getStyleDisplayName, getAptitudeColor;
        let getFilteredCharacters, getSkillRecommendations, getCharacterTrainingAdvice;
        let setupGlobalEventDelegation, initializeEventSystem;
        let createHomePage, createCharacterPlanner, createCharacterPlannerRedesigned;
        let renderApp, initializeApp;

        // Load all core modules in proper sequence
        window.UmaModuleLoader.loadCoreModules().then(() => {
            // Reference state from the loaded module
            const state = window.Uma.State;
            appState = state.appState;
            updateAppState = state.updateAppState;
            
            // Reference constants from the loaded module
            const constants = window.Uma.Constants;
            STYLES = constants.STYLES;
            TRACK_TYPES = constants.TRACK_TYPES;
            RARITIES = constants.RARITIES;
            APTITUDE_GRADES = constants.APTITUDE_GRADES;
            CHARACTERS = constants.CHARACTERS;
            STAT_THRESHOLDS = constants.STAT_THRESHOLDS;
            STAT_EFFICIENCY = constants.STAT_EFFICIENCY;
            SKILL_RECOMMENDATIONS = constants.SKILL_RECOMMENDATIONS;
            
            // Reference utils from the loaded module
            const utils = window.Uma.Utils;
            createElement = utils.createElement;
            getRarityStars = utils.getRarityStars;
            getStyleColor = utils.getStyleColor;
            getStyleDisplayName = utils.getStyleDisplayName;
            getAptitudeColor = utils.getAptitudeColor;
            
            // Reference data helpers from the loaded module
            const dataHelpers = window.Uma.DataHelpers;
            getFilteredCharacters = dataHelpers.getFilteredCharacters;
            
            // Reference skills from the loaded module
            const skills = window.Uma.Skills;
            getSkillRecommendations = skills.getSkillRecommendations;
            
            // Reference character advice from the loaded module
            const characterAdvice = window.Uma.CharacterAdvice;
            getCharacterTrainingAdvice = characterAdvice.getCharacterTrainingAdvice;
            
            // Reference events from the loaded module
            const events = window.Uma.Events;
            setupGlobalEventDelegation = events.setupGlobalEventDelegation;
            initializeEventSystem = events.initializeEventSystem;
            
            // Reference home page component from the loaded module
            const homePageComponent = window.Uma.Components.HomePage;
            createHomePage = homePageComponent.createHomePage;
            
            // Reference character planner component from the loaded module
            const characterPlannerComponent = window.Uma.Components.CharacterPlanner;
            createCharacterPlanner = characterPlannerComponent.createCharacterPlanner;
            
            // Reference redesigned character planner component from the loaded module
            console.log('Attempting to reference redesigned component...');
            console.log('Uma.Components:', window.Uma.Components);
            console.log('Available components:', Object.keys(window.Uma.Components || {}));
            
            const characterPlannerRedesignedComponent = window.Uma.Components.CharacterPlannerRedesigned;
            if (characterPlannerRedesignedComponent) {
                createCharacterPlannerRedesigned = characterPlannerRedesignedComponent.createCharacterPlannerRedesigned;
                console.log('Redesigned character planner component referenced globally');
            } else {
                console.warn('Redesigned character planner component not found in Uma.Components');
                console.log('Direct window check:', window.createCharacterPlannerRedesigned);
                // Fallback to direct window reference if module namespace failed
                if (window.createCharacterPlannerRedesigned) {
                    createCharacterPlannerRedesigned = window.createCharacterPlannerRedesigned;
                    console.log('Using direct window reference for redesigned planner');
                }
            }
            
            // Reference app controller from the loaded module
            const app = window.Uma.App;
            renderApp = app.renderApp;
            initializeApp = app.initializeApp;
            
            console.log('State, constants, utils, data helpers, skills, character advice, events, components, and app controller loaded from modules and referenced globally');
            
            // Initialize App after modules are loaded
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initializeApp);
            } else {
                // DOM is already loaded, initialize immediately
                initializeApp();
            }
            
        }).catch((error) => {
            console.error('Failed to load modules:', error);
        });

        // All core functionality has been extracted to external modules
    </script>

    <!-- PWA functionality and all other features are now handled by the modular app controller -->
</body>
</html>